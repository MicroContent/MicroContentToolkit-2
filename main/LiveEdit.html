<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>LiveEditTestHost</title>
    <!--Codemirror basics-->
    <script src="../codemirror-5.63.3/lib/codemirror.js"></script>
    <link rel="stylesheet" href="../codemirror-5.63.3/lib/codemirror.css">
    <!--Codemirror themes-->
    <link rel="stylesheet" href="../codemirror-5.63.3/theme/dracula.css">
    <!--Codemirror modes-->
    <script src="../codemirror-5.63.3/mode/xml/xml.js"></script>
    <script src="../codemirror-5.63.3/mode/css/css.js"></script>
    <script src="../codemirror-5.63.3/mode/javascript/javascript.js"></script>
    <script src="../codemirror-5.63.3/mode/htmlmixed/htmlmixed.js"></script>
    <!--Codemirror addons-->
    <link rel="stylesheet" href="../codemirror-5.63.3/addon/hint/show-hint.css">
    <script src="../codemirror-5.63.3/addon/hint/show-hint.js"></script>
    <script src="../codemirror-5.63.3/addon/hint/html-hint.js"></script>
    <script src="../codemirror-5.63.3/addon/hint/css-hint.js"></script>
    <script src="../codemirror-5.63.3/addon/hint/xml-hint.js"></script>
    <script src="../codemirror-5.63.3/addon/hint/javascript-hint.js"></script>
    <script src="../codemirror-5.63.3/addon/edit/closetag.js"></script>
    <script src="../codemirror-5.63.3/addon/edit/closebrackets.js"></script>
    <script src="../codemirror-5.63.3/addon/edit/matchtags.js"></script>
    <script src="../codemirror-5.63.3/addon/fold/xml-fold.js"></script>
    <!--other-->
    <link rel="stylesheet" href="../css/test.css">
    <script src="../js/script.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="../node_modules/seamless/build/seamless.parent.min.js"></script>
    
    <style>
        .CodeMirror {
            height: 100%;
            width: 100%;
            position: absolute
        }
    </style>
    <script type="text/javascript">
        var titleV;
        var questionV;
        // window.onload = function() {
        //     var child1 = document.getElementById('code_result_viewer');
        //     var child2 = document.getElementById('code_result_editor');
        //     // Turns the iframe into a seamless iframe.
        //     window.seamless(child1);
        //     window.seamless(child2);

            
        //     child2.receive(function(data) {
        //         switch(data.type) {
        //             case 'toViewer':
        //             if (data.hasOwnProperty('title')) {
        //                 titleV = data.title;
        //             }
        //             if (data.hasOwnProperty('question')) {
        //                 questionV= data.question;
        //             }
        //             console.log("got: ",titleV,questionV)
        //             break;
        //         }
        //     });
        //     window.sendToChild = function(event) {
        //         event.preventDefault();
        //         console.log("send:",titleV,questionV)
        //         child1.send({
        //             type: 'setContent',
        //             title: titleV,
        //             question: questionV
        //             });
        //         };

        //     window.injectStyles = function(event) {
            
        //         event.preventDefault();
        //             child1.send({
        //                 type: 'seamless_styles',
        //                 data: [document.getElementById('childstyles2').value]
        //             });
        //         };
        //     };
        
        function child2load(){
            var child2 = document.getElementById('code_result_editor');
            window.seamless(child2);
            child2.receive(function(data) {
                switch(data.type) {
                    case 'toViewer':
                    if (data.hasOwnProperty('title')) {
                        titleV = data.title;
                    }
                    if (data.hasOwnProperty('question')) {
                        questionV= data.question;
                    }
                    console.log("got: ",titleV,questionV)
                    break;
                }
            });
        };

        function child1load(){
            var child1 = document.getElementById('code_result_viewer');
            window.seamless(child1);
            window.sendToChild = function(event) {
                event.preventDefault();
                console.log("send:",titleV,questionV)
                child1.send({
                    type: 'setContent',
                    title: titleV,
                    question: questionV
                    });
                };

            window.injectStyles = function(event) {
            
                event.preventDefault();
                    child1.send({
                        type: 'seamless_styles',
                        data: [document.getElementById('childstyles2').value]
                    });
                };
            };

    </script>

</head>

<body>

    <div class="grid-container">
        <div class="Buttons">
            <div class="Editor-Section">

                <h2>Editor</h2>
                <input id="first_i" type="file">
                <button onclick="loadFileAsText()">Load the first editor</button>
                <button type="button" id="save1" onclick="saveTextAsFile()">Save editor plugin to file</button>

                <br><br>
                <label>Src-Code into Editor Section</label>
                <input type="text" placeholder="Enter URL..." id="url-editor-input">
                <button id="url-editor" type="button" onclick="getSrcintoEditor()">Load Editor-CodeMirror</button>

            </div>


            <div id="filler"></div>
            <div id="filler"></div>


            <div class="Viewer-Section">

                <h2>Viewer</h2>
                <input id="second_i" type="file">
                <button onclick="loadFileAsText2()">Load the second editor</button>
                <button type="button" id="save2" onclick="saveTextAsFile2()">Save viewer plugin to file</button>

                <br><br>
                <label>Src-Code into Viewer Section</label>
                <input type="text" placeholder="Enter URL..." id="url-viewer-input">
                <button id="url" type="button" onclick="getSrcintoViewer()">Load Viewer-CodeMirror</button>

                <br><br>
                
            </div>
            <div id="filler"></div>
            <div id="filler"></div>
            <div class="Injection-Section">

                <h2>Style Injection</h2>
                <!--seamless injection-->
                <label for="url">Open Stylesheet</label><br>
                
                <input style="width: auto;" placeholder="Enter CSS's URL..." type="file" id="childstyles"><br>
                <input id="childstyles2" type="text" placeholder="Enter a style">
                <button type="button" style="width: auto;" onclick="injectStyles(event)">Submit</button>
                <!-- <a href="#" id="injectstyles" onclick="injectStyles(event)" class="button postfix">Submit</a> -->
                <script>
                    document.getElementById("childstyles").addEventListener("change", readFileAsString)
                    function readFileAsString() {
                        f=document.getElementById('childstyles')
                        var files = f.files;
                        if (files.length === 0) {
                            console.log('No file is selected');
                            return;
                        }
                
                        var reader = new FileReader();
                        
                        reader.onload = function() {
                            console.log(reader.result) 
                            var  outp= reader.result;
                            var fin=document.getElementById('childstyles2');
                            fin.value=outp;
                        };
                        reader.readAsText(files[0]);
                        console.log(reader)
                        console.log(reader.result)
                        
                    }
                </script>

            </div>



        </div>
        <div class="Edit-editor" id="editor1"
            style="position:relative;border: 1px rgb(0, 17, 255) solid; margin: 0.5%;">
            <textarea id="live" class="form-control">Upload to change editor...</textarea>
            <script>
                var editor = CodeMirror.fromTextArea
                    (document.getElementById('live'), {
                        mode: "htmlmixed",
                        theme: "dracula",
                        lineNumbers: true,
                        autoCloseTags: true,
                        extraKeys: { "Ctrl-Space": "autocomplete" },
                        autoCloseBrackets: true,
                        matchTags: true
                    });

            </script>

        </div>



        <div class="Edit-viewer" id="editor2"
            style="position:relative; border: 1px rgb(0, 17, 255) solid; margin: 0.5%;">
            <textarea id="live2" class="form-control">Upload to change viewer...</textarea>
            <script>
                var editor2 = CodeMirror.fromTextArea
                    (document.getElementById('live2'), {
                        mode: "htmlmixed",
                        theme: "dracula",
                        lineNumbers: true,
                        autoCloseTags: true,
                        extraKeys: { "Ctrl-Space": "autocomplete" },
                        autoCloseBrackets: true,
                        matchTags: true

                    });

            </script>


        </div>



        <div class="Editor" id='editor' style=" border: 1px rgb(0, 17, 255) solid; margin: 0.5%; overflow: scroll">
            <div class="panel-heading">
                <h2>Editor</h2>
                <button class="btn btn-raised btn-info" onclick="reloadEditor(); child2load()">Reload Editor</button>
            </div>
            <div class="panel-body" id="editor_container"></div>

            <iframe id="code_result_editor" style="width:95%; height:80%" scrolling="yes" src="" ></iframe>

        </div>

        <div class="Data" id='data' style="border: 1px rgb(0, 17, 255) solid; margin: 0.5%; overflow: scroll">
            <div class="panel-heading">
                <h2>Data</h2>
                <!-- send to viewer -->
                <button type="button" style="width: auto;" onclick="sendToChild(event)">Send data to viewer</button>
                <!-- <a href="#" id="sendToChild" onclick="sendToChild(event)" class="button postfix">Load Data from Editor</a> -->
            </div>
            <div class="panel-body">
                <textarea id="data-input" style="width: 80%; min-height: 150px"></textarea>
            </div>
        </div>

        <div class="Viewer" id='viewer' style=" border: 1px rgb(0, 17, 255) solid; margin: 0.5%; overflow: scroll" >
            <div class="panel-heading">
                <h2>Viewer</h2>
                <button  class="btn btn-raised btn-info" onclick="reloadViewer(); child1load()">Reload Viewer</button>
            </div>
            <div class="panel-body" id="viewer_container"></div>
            <br>
            <div class="panel-footer">
                <button onclick="window.onViewerSubmitListener()">Submit/Undo</button>
            </div>

            <iframe id="code_result_viewer" style="width:95%; height:80%" scrolling="yes"  src=""></iframe>

        </div>
    </div>
    <!--injection script-->
    
</body>

</html>
